(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["app.depot"],{"816f":function(t,e,r){var a,i=r("3d15").wrap,n=r("9a86");t.exports=function t(){return this instanceof t?i(n()):a||(a=i(n()))}},8253:function(t,e,r){},8679:function(t,e,r){"use strict";var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("img",{staticClass:"arkn-item mdui-m-r-1 no-sl no-pe",style:{width:t.widthCss,height:t.widthCss},attrs:{src:t.$root.materialImage(t.img),crossorigin:"anonymous"}})},i=[],n=(r("a9e3"),{name:"arkn-item",computed:{widthCss:function(){return"number"===typeof this.width?"".concat(this.width,"px"):this.width}},props:{img:String,width:{type:[Number,String],default:48}}}),s=n,o=(r("f12a"),r("2877")),u=Object(o["a"])(s,a,i,!1,null,"0c9251f7",null);e["a"]=u.exports},"8ba6":function(t,e,r){},"9a86":function(t,e,r){t.exports=function(){return new Worker(r.p+"e0c4760fa19962b4d510.worker.js")}},a3d0:function(t,e,r){"use strict";r.r(e);var a=function(){var t=this,e=t.$createElement,r=t._self._c||e;return r("div",{attrs:{id:"arkn-depot"}},[t.imgSrc?[r("div",{staticClass:"mdui-typo-body-2 mdui-m-b-1 no-sl"},[t._v(t._s(t.$t("depot.result.tip")))]),r("div",{staticClass:"result-scrollable",style:{"overflow-x":t.drProgress?"hidden":""},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.useImg(e.dataTransfer.files[0])}(e)},contextmenu:function(t){t.preventDefault()}}},[r("div",{staticClass:"result-wrapper"},[r("div",{staticClass:"result-container",style:{backgroundImage:"url("+(t.imgSrc||t.PNG1P)+")",paddingBottom:100*t.imgRatio+"%"}},t._l(t.drData,(function(e,a){var i=e.posPct,n=e.sim,s=e.num;return r("div",{directives:[{name:"show",rawName:"v-show",value:n,expression:"sim"}],key:a,staticClass:"result-square pointer",class:{disabled:!t.drSelect[a]},style:t.num2pct(i),on:{click:function(e){return e.target!==e.currentTarget?null:t.$set(t.drSelect,a,!t.drSelect[a])},contextmenu:function(e){return e.preventDefault(),t.editResult(a)}}},[n?r("div",{staticClass:"result-sim mdui-valign",class:{"mdui-ripple mdui-ripple-white":t.drSelect[a]},on:{click:function(e){return t.editResult(a)}}},[r("arkn-item",{staticClass:"result-sim-img",staticStyle:{height:"100%"},attrs:{t:t.materialTable[n.name].rare,img:n.name,width:""}}),r("div",{staticClass:"result-sim-num no-pe no-sl"},[t._v(t._s(s.value)),s.warn&&!s.edit?r("small",[t._v("⚠️")]):t._e()])],1):t._e()])})),0)]),r("div",{staticClass:"debug-checkbox-wrapper"},[r("mdui-checkbox",{staticClass:"debug-checkbox",model:{value:t.debug,callback:function(e){t.debug=e},expression:"debug"}},[t._v("Debug")])],1),r("div",{directives:[{name:"show",rawName:"v-show",value:t.drProgress,expression:"drProgress"}],staticClass:"result-progress"},[r("mdui-spinner",{staticClass:"mdui-m-r-1",attrs:{colorful:!0}}),r("div",{staticClass:"mdui-typo-body-1 mdui-text-color-black-text"},[t._v(t._s(t.drProgress))])],1)]),t.drData.length?r("div",{staticClass:"mdui-row mdui-m-t-2"},[r("div",{staticClass:"mdui-col-xs-6"},[r("label",{directives:[{name:"theme-class",rawName:"v-theme-class",value:["mdui-color-purple","mdui-color-purple-a100 mdui-ripple-black"],expression:"['mdui-color-purple', 'mdui-color-purple-a100 mdui-ripple-black']"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",attrs:{for:"img-select"},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.useImg(e.dataTransfer.files[0])}(e)}}},[t._v(t._s(t.$t("depot.result.selectImage")))])]),r("div",{staticClass:"mdui-col-xs-6"},[r("button",{directives:[{name:"theme-class",rawName:"v-theme-class",value:t.$root.color.pinkBtn,expression:"$root.color.pinkBtn"}],staticClass:"mdui-btn mdui-btn-raised mdui-ripple mdui-btn-block",on:{click:t.importItems}},[t._v(t._s(t.$t("common.import")))])])]):t._e()]:r("label",{staticClass:"image-select pointer mdui-valign mdui-text-center mdui-p-a-4",attrs:{for:"img-select"},on:{dragover:function(t){t.preventDefault()},drop:function(e){return e.preventDefault(),function(e){return t.useImg(e.dataTransfer.files[0])}(e)}}},[r("div",{staticClass:"mdui-typo-display-1-opacity mdui-hidden-xs",domProps:{innerHTML:t._s(t.$t("depot.input.title"))}}),r("div",{staticClass:"mdui-typo-headline mdui-hidden-sm-up",staticStyle:{opacity:"0.54"},domProps:{innerHTML:t._s(t.$t("depot.input.title"))}}),r("div",{staticClass:"mdui-typo-body-2 mdui-m-t-2"},[t._v(t._s(t.$t("depot.input.notice")))])]),r("input",{ref:"image",staticStyle:{display:"none"},attrs:{type:"file",id:"img-select",accept:"image/jpeg,image/png"},on:{change:function(e){return t.useImg(t.$refs.image.files[0])}}}),t.debug?r("div",{staticClass:"mdui-m-t-4 no-sl",attrs:{id:"debug"}},[t._l(t.drData,(function(e,a){var i=e.num;return[i?r("div",{key:a,staticClass:"debug-item mdui-m-r-3 mdui-m-b-2"},[r("img",{staticClass:"debug-img no-pe mdui-m-r-1",attrs:{src:i.img}}),r("pre",{staticClass:"mdui-m-y-0"},[t._v("text: "+t._s(i.text))])]):t._e()]}))],2):t._e()],2)},i=[],n=(r("99af"),r("4de4"),r("caad"),r("d81d"),r("b0c0"),r("d3b7"),r("ac1f"),r("3ca3"),r("1276"),r("2ca0"),r("498a"),r("ddb0"),r("2b3d"),r("b85c")),s=r("5530"),o=(r("96cf"),r("1da1")),u=r("60bb"),c=r.n(u),d=r("b9af"),l="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mNkYAAAAAYAAjCB0C8AAAAASUVORK5CYII=",m=r("8679"),p=r("de76"),f=r("816f"),g=r.n(f),v=new g.a,b={name:"arkn-depot",components:{ArknItem:m["a"]},data:function(){return{PNG1P:l,materialTable:p["b"],imgSrc:null,imgRatio:0,drData:[],drSelect:[],drProgress:"",debug:!1}},methods:{num2pct:function(t){return c.a.mapValues(t,(function(t){return"".concat(c.a.round(100*t,3),"%")}))},useImg:function(t){var e=this;return Object(o["a"])(regeneratorRuntime.mark((function r(){var a;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:if(t&&["image/jpeg","image/png"].includes(t.type)){r.next=2;break}return r.abrupt("return");case 2:return e.drData=[],e.drSelect=[],e.drProgress="Processing",e.imgRatio=0,e.imgSrc=window.URL.createObjectURL(t),e.updateRatio(e.imgSrc),r.next=10,v.recognize(e.imgSrc);case 10:a=r.sent,e.drData=a,e.drSelect=a.map((function(){return!0})),e.drProgress="";case 14:case"end":return r.stop()}}),r)})))()},updateRatio:function(t){var e=this,r=new Image;r.src=t,r.onload=function(){e.imgRatio=r.height/r.width}},editResult:function(t){var e=this;this.$prompt("材料数量","修改结果",(function(r){var a=r.trim();/^[0-9]+$/.test(a)?(e.drData[t].num.value=parseInt(a),e.drData[t].num.edit=!0):e.editResult(t)}),(function(){}),{history:!1,confirmOnEnter:!0,cancelText:this.$t("common.cancel"),confirmText:this.$t("common.edit"),defaultValue:this.drData[t].num.value})},importItems:function(){if(this.$root.importItemsListening)this.$root.$emit("importItems",this.itemsWillBeImported);else{var t="depot.imports",e=Object(s["a"])(Object(s["a"])({},Object(d["a"])(localStorage.getItem(t))),this.itemsWillBeImported);localStorage.setItem(t,JSON.stringify(e))}this.$snackbar(this.$t("depot.result.imported"))},pasteImg:function(t){var e=this,r=t.ctrlKey,a=t.altKey,i=t.keyCode;86===i&&this.$route.path.startsWith("/depot")&&(r||navigator&&"platform"in navigator&&navigator.platform.startsWith("Mac")&&a)&&this.readClipboardImg().then(this.useImg).catch((function(t){console.warn(t),"DataError"===t.name&&e.$snackbar({message:e.$t("hr.ocr.pasteDataError"),timeout:6e3})}))},readClipboardImg:function(){var t=this;return Object(o["a"])(regeneratorRuntime.mark((function e(){var r,a,i,s,o,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.$requestClipboardPermission("clipboard-read");case 2:if(e.sent){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,navigator.clipboard.read();case 6:r=e.sent,a=Object(n["a"])(r),e.prev=8,a.s();case 10:if((i=a.n()).done){e.next=20;break}if(s=i.value,o=s.types.filter((function(t){return t.startsWith("image/")})),!(o.length>0)){e.next=18;break}return e.next=16,s.getType(o[0]);case 16:return u=e.sent,e.abrupt("return",new File([u],"depot-".concat(Date.now(),".").concat(c.a.last(o[0].split("/"))),{type:o[0]}));case 18:e.next=10;break;case 20:e.next=25;break;case 22:e.prev=22,e.t0=e["catch"](8),a.e(e.t0);case 25:return e.prev=25,a.f(),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[8,22,25,28]])})))()}},computed:{itemsWillBeImported:function(){var t=this;return c.a.fromPairs(this.drData.filter((function(e,r){var a=e.sim,i=e.num;return a&&i&&t.drSelect[r]})).map((function(t){var e=t.sim.name,r=t.num.value;return[e,r]})))}},created:function(){this.$$(window).on("keydown",this.pasteImg),v.setResourceStaticBaseURL(this.$root.staticBaseURL)},beforeDestroy:function(){this.$$(window).off("keydown",this.pasteImg)}},h=b,w=(r("db2a"),r("2877")),k=Object(w["a"])(h,a,i,!1,null,null,null);e["default"]=k.exports},db2a:function(t,e,r){"use strict";var a=r("8ba6"),i=r.n(a);i.a},de76:function(t,e,r){"use strict";r.d(e,"b",(function(){return o}));r("d81d"),r("b0c0"),r("07ac");var a=r("5530"),i=r("60bb"),n=r.n(i),s=r("9d72"),o=n.a.mapValues(s,(function(t,e){return Object(a["a"])({name:e},t)})),u=Object.values(o),c=n.a.groupBy(u,(function(t){var e=t.rare;return e})),d=n.a.sortBy(n.a.clone(u),"sortId").map((function(t){var e=t.name;return e}));e["a"]={materials:c,materialTable:o,materialList:u,materialOrder:d}},f12a:function(t,e,r){"use strict";var a=r("8253"),i=r.n(a);i.a}}]);